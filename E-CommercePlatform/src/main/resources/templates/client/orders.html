<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒê∆°n H√†ng C·ªßa T√¥i</title>
    <link rel="stylesheet" th:href="@{/client/products.css}">
    <link rel="stylesheet" th:href="@{/client/icons.css}">
    <link rel="stylesheet" th:href="@{/client/orders.css}">
</head>
<body>
    <!-- Header -->
    <div th:replace="~{client/fragments/header :: header}"></div>

    <!-- Main Content -->
    <div class="orders-container">
        <!-- Success Message for New Order -->
        <div th:if="${successMessage != null and orderCode != null}" class="success-message" id="orderSuccessMessage">
            <div class="success-icon">‚úì</div>
            <h2>ƒê·∫∑t H√†ng Th√†nh C√¥ng!</h2>
            <p th:text="${successMessage}">ƒê·∫∑t h√†ng th√†nh c√¥ng!</p>
            <p>M√£ ƒë∆°n h√†ng: <strong th:text="${orderCode}">ORD_xxx</strong></p>
            <p class="cod-note">
                B·∫°n ƒë√£ ch·ªçn thanh to√°n khi nh·∫≠n h√†ng. Vui l√≤ng chu·∫©n b·ªã ti·ªÅn m·∫∑t khi nh·∫≠n h√†ng.
            </p>
        </div>

        <!-- Generic Success/Error Messages (for cancellation, etc.) -->
        <div th:if="${successMessage != null and orderCode == null}" class="alert alert-success" id="genericSuccessMessage">
            <span class="icon icon-md icon-check-circle icon-inline"></span>
            <span th:text="${successMessage}">Th√†nh c√¥ng!</span>
        </div>

        <div th:if="${errorMessage != null}" class="alert alert-error" id="errorMessage">
            <span class="icon icon-md icon-error icon-inline"></span>
            <span th:text="${errorMessage}">C√≥ l·ªói x·∫£y ra!</span>
        </div>

        <h1 class="page-title">ƒê∆°n H√†ng C·ªßa T√¥i</h1>

        <!-- Orders List -->
        <div th:if="${not #lists.isEmpty(orders)}">
            <div class="order-card" th:each="order : ${orders}">
                <div class="order-header">
                    <div class="order-code">
                        <span class="icon icon-md icon-inline" style="background-image: url('data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27currentColor%27 stroke-width=%272%27%3E%3Cpath d=%27M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2%27/%3E%3C/svg%3E');"></span>
                        <span th:text="${order.orderCode}">ORD_123456</span>
                    </div>
                    <span class="order-status"
                          th:classappend="${order.paymentStatus == 'PAID' ? 'status-paid' : (order.paymentStatus == 'PENDING' ? 'status-pending' : (order.paymentStatus == 'CANCELLED' ? 'status-cancelled' : 'status-failed'))}">
                        <span th:if="${order.paymentStatus == 'PAID'}">‚úì ƒê√£ Thanh To√°n</span>
                        <span th:if="${order.paymentStatus == 'PENDING'}">‚è≥ Ch·ªù Thanh To√°n</span>
                        <span th:if="${order.paymentStatus == 'CANCELLED'}">üö´ ƒê√£ H·ªßy</span>
                        <span th:if="${order.paymentStatus == 'FAILED'}">‚úó Th·∫•t B·∫°i</span>
                    </span>
                </div>

                <div class="order-info">
                    <div class="info-item">
                        <span class="info-label">Ng√†y ƒë·∫∑t h√†ng</span>
                        <span class="info-value" th:text="${#temporals.format(order.createdAt, 'dd/MM/yyyy HH:mm')}">22/01/2026 10:30</span>
                    </div>

                    <div class="info-item" th:if="${order.paidAt != null}">
                        <span class="info-label">Ng√†y thanh to√°n</span>
                        <span class="info-value" th:text="${#temporals.format(order.paidAt, 'dd/MM/yyyy HH:mm')}">22/01/2026 10:35</span>
                    </div>

                    <div class="info-item">
                        <span class="info-label">Ph∆∞∆°ng th·ª©c thanh to√°n</span>
                        <span class="payment-method">
                            <span th:if="${order.paymentMethod == 'CASH'}">Ti·ªÅn m·∫∑t</span>
                            <span th:if="${order.paymentMethod == 'MOMO'}">MoMo</span>
                            <span th:if="${order.paymentMethod != 'CASH' && order.paymentMethod != 'MOMO'}" th:text="${order.paymentMethod}">Kh√°c</span>
                        </span>
                    </div>

                    <div class="info-item">
                        <span class="info-label">T·ªïng ti·ªÅn</span>
                        <span class="order-total" th:text="${#numbers.formatDecimal(order.finalPrice, 0, 'COMMA', 0, 'POINT')} + ' ƒë'">28,990,000 ƒë</span>
                    </div>
                </div>

                <div class="order-actions">
                    <a th:href="@{/orders/{id}(id=${order.id})}" class="btn btn-primary">Xem Chi Ti·∫øt</a>
                    <a th:if="${order.paymentStatus == 'PENDING' && order.paymentMethod != 'CASH'}" href="#" class="btn">Thanh To√°n L·∫°i</a>
                    <form th:if="${order.paymentStatus == 'PENDING'}"
                          th:action="@{/orders/cancel/{id}(id=${order.id})}"
                          method="post"
                          style="display: inline;"
                          onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy ƒë∆°n h√†ng n√†y?')">
                        <button type="submit" class="btn btn-danger">H·ªßy ƒê∆°n H√†ng</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- No Orders -->
        <div class="no-orders" th:if="${#lists.isEmpty(orders)}">
            <span class="icon icon-xxl icon-centered" style="background-image: url('data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27%23ccc%27 stroke-width=%271%27%3E%3Cpath d=%27M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2%27/%3E%3C/svg%3E');"></span>
            <h2>B·∫°n ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</h2>
            <p>H√£y kh√°m ph√° v√† mua s·∫Øm c√°c s·∫£n ph·∫©m laptop tuy·ªát v·ªùi c·ªßa ch√∫ng t√¥i!</p>
            <a href="/products" class="btn btn-primary">Mua S·∫Øm Ngay</a>
        </div>
    </div>

    <!-- Footer -->
    <div th:replace="~{client/fragments/footer :: footer}"></div>

    <script>
        // Auto-hide messages after 10 seconds
        function autoHideMessage(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                setTimeout(function() {
                    element.style.opacity = '0';
                    element.style.transition = 'opacity 0.5s ease-out';
                    setTimeout(function() {
                        element.style.display = 'none';
                    }, 500);
                }, 10000); // 10 seconds
            }
        }

        // Auto-hide all messages
        autoHideMessage('orderSuccessMessage');
        autoHideMessage('genericSuccessMessage');
        autoHideMessage('errorMessage');
    </script>
</body>
</html>
