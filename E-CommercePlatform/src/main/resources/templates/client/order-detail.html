<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi Ti·∫øt ƒê∆°n H√†ng</title>
    <link rel="stylesheet" th:href="@{/client/products.css}">
    <link rel="stylesheet" th:href="@{/client/icons.css}">
    <link rel="stylesheet" th:href="@{/client/order-detail.css}">
</head>
<body>
    <!-- Header -->
    <div th:replace="~{client/fragments/header :: header}"></div>

    <!-- Main Content -->
    <div class="order-detail-container">
        <!-- Success Message (from payment) -->
        <div th:if="${successMessage}" class="alert alert-success" id="successMessage" style="margin-bottom: 20px;">
            <span class="icon icon-md icon-success icon-inline"></span>
            <span th:text="${successMessage}"></span>
        </div>

        <a href="/orders" class="back-link">
            <span class="icon icon-md icon-back-arrow icon-inline"></span>
            Quay L·∫°i Danh S√°ch ƒê∆°n H√†ng
        </a>

        <h1 class="page-title">Chi Ti·∫øt ƒê∆°n H√†ng</h1>

        <!-- Order Info Card -->
        <div class="order-info-card">
            <span class="status-badge"
                  th:classappend="${order.paymentStatus == 'PAID' ? 'status-paid' : (order.paymentStatus == 'PENDING' ? 'status-pending' : (order.paymentStatus == 'CANCELLED' ? 'status-cancelled' : 'status-failed'))}">
                <span th:if="${order.paymentStatus == 'PAID'}">‚úì ƒê√£ Thanh To√°n</span>
                <span th:if="${order.paymentStatus == 'PENDING'}">‚è≥ Ch·ªù Thanh To√°n</span>
                <span th:if="${order.paymentStatus == 'CANCELLED'}">üö´ ƒê√£ H·ªßy</span>
                <span th:if="${order.paymentStatus == 'FAILED'}">‚úó Thanh To√°n Th·∫•t B·∫°i</span>
            </span>

            <div class="info-grid">
                <div class="info-row">
                    <span class="info-label">M√£ ƒë∆°n h√†ng</span>
                    <span class="info-value" th:text="${order.orderCode}">ORD_123456</span>
                </div>

                <div class="info-row">
                    <span class="info-label">Ng√†y ƒë·∫∑t h√†ng</span>
                    <span class="info-value" th:text="${#temporals.format(order.createdAt, 'dd/MM/yyyy HH:mm')}">22/01/2026 10:30</span>
                </div>

                <div class="info-row" th:if="${order.paidAt != null}">
                    <span class="info-label">Ng√†y thanh to√°n</span>
                    <span class="info-value" th:text="${#temporals.format(order.paidAt, 'dd/MM/yyyy HH:mm')}">22/01/2026 10:35</span>
                </div>

                <div class="info-row">
                    <span class="info-label">Ph∆∞∆°ng th·ª©c thanh to√°n</span>
                    <span class="info-value">
                        <span th:if="${order.paymentMethod == 'CASH'}">Ti·ªÅn m·∫∑t</span>
                        <span th:if="${order.paymentMethod == 'MOMO'}">MoMo</span>
                        <span th:if="${order.paymentMethod != 'CASH' && order.paymentMethod != 'MOMO'}" th:text="${order.paymentMethod}">Kh√°c</span>
                    </span>
                </div>

                <div class="info-row" th:if="${order.address != null}">
                    <span class="info-label">ƒê·ªãa ch·ªâ giao h√†ng</span>
                    <span class="info-value" th:text="${order.address}">123 ƒê∆∞·ªùng ABC, TP.HCM</span>
                </div>
            </div>
        </div>

        <!-- Products Section -->
        <div class="products-section">
            <h2 class="section-title">S·∫£n Ph·∫©m ƒê√£ Mua</h2>

            <div th:if="${order.orderDetails != null && not #lists.isEmpty(order.orderDetails)}">
                <div class="product-item" th:each="detail : ${order.orderDetails}">
                    <img th:if="${detail.product.url != null && !detail.product.url.isEmpty()}"
                         th:src="${detail.product.url}"
                         th:alt="${detail.product.name}"
                         class="product-image">
                    <div th:if="${detail.product.url == null || detail.product.url.isEmpty()}"
                         class="product-image no-image-placeholder">
                        <span class="icon icon-lg icon-no-image icon-centered"></span>
                    </div>

                    <div class="product-details">
                        <div class="product-name" th:text="${detail.product.name}">Laptop ABC</div>
                        <div class="product-meta">
                            <span>S·ªë l∆∞·ª£ng: <strong th:text="${detail.quantity}">1</strong></span>
                            <span>ƒê∆°n gi√°: <strong th:text="${#numbers.formatDecimal(detail.price, 0, 'COMMA', 0, 'POINT')} + ' ƒë'">28,990,000 ƒë</strong></span>
                        </div>
                    </div>

                    <div class="product-price" th:text="${#numbers.formatDecimal(detail.price * detail.quantity, 0, 'COMMA', 0, 'POINT')} + ' ƒë'">
                        28,990,000 ƒë
                    </div>
                </div>
            </div>

            <!-- Order Summary -->
            <div class="order-summary">
                <div class="summary-row">
                    <span>T·ªïng ti·ªÅn h√†ng</span>
                    <span th:text="${#numbers.formatDecimal(order.finalPrice, 0, 'COMMA', 0, 'POINT')} + ' ƒë'">28,990,000 ƒë</span>
                </div>
                <div class="summary-row">
                    <span>Ph√≠ v·∫≠n chuy·ªÉn</span>
                    <span>Mi·ªÖn ph√≠</span>
                </div>
                <div class="summary-row total">
                    <span>T·ªïng c·ªông</span>
                    <span th:text="${#numbers.formatDecimal(order.finalPrice, 0, 'COMMA', 0, 'POINT')} + ' ƒë'">28,990,000 ƒë</span>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="actions-center">
            <a th:if="${order.paymentStatus == 'PENDING' && order.paymentMethod != 'CASH'}" href="#" class="btn btn-primary">Thanh To√°n L·∫°i</a>
            <form th:if="${order.paymentStatus == 'PENDING'}"
                  th:action="@{/orders/cancel/{id}(id=${order.id})}"
                  method="post"
                  style="display: inline;"
                  onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy ƒë∆°n h√†ng n√†y?')">
                <button type="submit" class="btn btn-danger">H·ªßy ƒê∆°n H√†ng</button>
            </form>
            <a href="/products" class="btn">Ti·∫øp T·ª•c Mua S·∫Øm</a>
        </div>
    </div>

    <!-- Footer -->
    <div th:replace="~{client/fragments/footer :: footer}"></div>

    <script>
        // Auto-hide success message after 10 seconds
        const successMessage = document.getElementById('successMessage');
        if (successMessage) {
            setTimeout(function() {
                successMessage.style.opacity = '0';
                successMessage.style.transition = 'opacity 0.5s ease-out';
                setTimeout(function() {
                    successMessage.style.display = 'none';
                }, 500);
            }, 10000); // 10 seconds
        }
    </script>
</body>
</html>
