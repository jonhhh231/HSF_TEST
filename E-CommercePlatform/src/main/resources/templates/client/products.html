<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laptop Store - Premium Laptops</title>
    <link rel="stylesheet" th:href="@{/client/icons.css}">
    <link rel="stylesheet" th:href="@{/client/products.css}">
</head>
<body>
    <!-- Header -->
    <div th:replace="~{client/fragments/header :: header}"></div>
    <!-- Main Content -->
    <div class="container">
        <!-- Filter Section -->
        <div class="filter-section">
            <h3>Danh Mục</h3>
            <div class="filter-buttons">
                <a href="/products" class="filter-btn" th:classappend="${categoryId == null ? 'active' : ''}">
                    Tất Cả Sản Phẩm
                </a>
                <a href="/products?category=1" class="filter-btn" th:classappend="${categoryId == 1 ? 'active' : ''}">
                    Laptop Gaming
                </a>
                <a href="/products?category=2" class="filter-btn" th:classappend="${categoryId == 2 ? 'active' : ''}">
                    Laptop Văn Phòng
                </a>
                <a href="/products?category=3" class="filter-btn" th:classappend="${categoryId == 3 ? 'active' : ''}">
                    Laptop Mỏng Nhẹ
                </a>
            </div>
        </div>

        <!-- Results Header -->
        <div class="results-header">
            <div class="results-info">
                <span th:if="${totalItems > 0}">
                    Hiển thị <strong th:text="${products.size()}"></strong> trong số
                    <strong th:text="${totalItems}"></strong> sản phẩm
                </span>
            </div>
        </div>

        <!-- Product Grid -->
        <div class="product-grid" th:if="${not #lists.isEmpty(products)}">
            <div th:each="product : ${products}" class="product-card">
                <a th:href="@{/products/{id}(id=${product.id})}" class="product-link">
                    <div class="product-image">
                        <img th:if="${product.url != null && !product.url.isEmpty()}"
                             th:src="${product.url}"
                             th:alt="${product.name}">
                        <div th:if="${product.url == null || product.url.isEmpty()}" class="no-image">
                            <span class="icon icon-xl icon-no-image icon-centered" style="width: 80px; height: 80px;"></span>
                        </div>
                    </div>

                    <div class="product-info">
                        <h3 class="product-name" th:text="${product.name}">Laptop gaming</h3>

                        <!-- Specs displayed directly in HTML -->
                        <div class="product-specs">
                            <!-- CPU -->
                            <span class="spec-item" th:if="${product.description != null and product.description.toLowerCase().contains('ryzen')}">
                                <span class="icon icon-cpu"></span>
                                <span th:text="${#strings.substring(product.description, #strings.indexOf(product.description.toLowerCase(), 'ryzen'), #strings.indexOf(product.description.toLowerCase(), 'ryzen') + 15)}"></span>
                            </span>
                            <span class="spec-item" th:if="${product.description != null and (product.description.toLowerCase().contains('i5') or product.description.toLowerCase().contains('i7') or product.description.toLowerCase().contains('i3') or product.description.toLowerCase().contains('i9'))}">
                                <span class="icon icon-cpu"></span>
                                <span th:if="${product.description.toLowerCase().contains('i5')}" th:text="'Intel i5'"></span>
                                <span th:if="${product.description.toLowerCase().contains('i7')}" th:text="'Intel i7'"></span>
                                <span th:if="${product.description.toLowerCase().contains('i3')}" th:text="'Intel i3'"></span>
                                <span th:if="${product.description.toLowerCase().contains('i9')}" th:text="'Intel i9'"></span>
                            </span>
                            <span class="spec-item" th:if="${product.description != null and (product.description.toLowerCase().contains('m1') or product.description.toLowerCase().contains('m2') or product.description.toLowerCase().contains('m3'))}">
                                <span class="icon icon-cpu"></span>
                                <span th:if="${product.description.toLowerCase().contains('m1')}" th:text="'Apple M1'"></span>
                                <span th:if="${product.description.toLowerCase().contains('m2')}" th:text="'Apple M2'"></span>
                                <span th:if="${product.description.toLowerCase().contains('m3')}" th:text="'Apple M3'"></span>
                            </span>

                            <!-- GPU -->
                            <span class="spec-item" th:if="${product.description != null and (product.description.toLowerCase().contains('rtx') or product.description.toLowerCase().contains('gtx'))}">
                                <span class="icon icon-gpu"></span>
                                <span th:if="${product.description.toLowerCase().contains('rtx 3050')}" th:text="'RTX 3050'"></span>
                                <span th:if="${product.description.toLowerCase().contains('rtx 3060')}" th:text="'RTX 3060'"></span>
                                <span th:if="${product.description.toLowerCase().contains('rtx 3070')}" th:text="'RTX 3070'"></span>
                                <span th:if="${product.description.toLowerCase().contains('rtx 4050')}" th:text="'RTX 4050'"></span>
                                <span th:if="${product.description.toLowerCase().contains('rtx 4060')}" th:text="'RTX 4060'"></span>
                                <span th:if="${product.description.toLowerCase().contains('gtx')}" th:text="'GTX'"></span>
                            </span>

                            <!-- RAM -->
                            <span class="spec-item" th:if="${product.description != null and product.description.toLowerCase().contains('gb ram')}">
                                <span class="icon icon-ram"></span>
                                <span th:if="${product.description.toLowerCase().contains('8gb ram')}" th:text="'8 GB'"></span>
                                <span th:if="${product.description.toLowerCase().contains('16gb ram')}" th:text="'16 GB'"></span>
                                <span th:if="${product.description.toLowerCase().contains('32gb ram')}" th:text="'32 GB'"></span>
                                <span th:if="${product.description.toLowerCase().contains('64gb ram')}" th:text="'64 GB'"></span>
                            </span>

                            <!-- Storage -->
                            <span class="spec-item" th:if="${product.description != null and product.description.toLowerCase().contains('ssd')}">
                                <span class="icon icon-storage"></span>
                                <span th:if="${product.description.toLowerCase().contains('256gb ssd')}" th:text="'256 GB'"></span>
                                <span th:if="${product.description.toLowerCase().contains('512gb ssd')}" th:text="'512 GB'"></span>
                                <span th:if="${product.description.toLowerCase().contains('1tb ssd')}" th:text="'1 TB'"></span>
                                <span th:if="${product.description.toLowerCase().contains('2tb ssd')}" th:text="'2 TB'"></span>
                            </span>
                        </div>

                        <div class="product-specs-secondary">
                            <!-- Screen size, refresh rate, battery, weight can be added here if needed -->
                        </div>

                        <div class="product-price-section">
                            <div class="price-row">
                                <div class="current-price" th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + 'đ'">
                                    26.890.000đ
                                </div>
                            </div>
                        </div>

                        <div class="product-rating">
                            <span class="rating-stars" th:text="${productRatings[product.id]} + ' ★'">0.0 ★</span>
                            <span class="rating-count" th:text="'(' + ${productReviewCounts[product.id]} + ' đánh giá)'">(0 đánh giá)</span>
                        </div>
                    </div>
                </a>
            </div>
        </div>

        <!-- No Products -->
        <div class="no-products" th:if="${#lists.isEmpty(products)}">
            <h2>Không tìm thấy sản phẩm</h2>
            <p>Vui lòng thử điều chỉnh tiêu chí tìm kiếm hoặc bộ lọc</p>
        </div>

        <!-- Pagination -->
        <div class="pagination" th:if="${totalPages > 1}">
            <a th:if="${currentPage > 1}"
               th:href="@{/products(page=${currentPage - 1}, category=${categoryId}, search=${search})}">
                « Trước
            </a>

            <span th:each="i : ${#numbers.sequence(1, totalPages)}"
                  th:classappend="${i == currentPage ? 'active' : ''}">
                <a th:if="${i != currentPage}"
                   th:href="@{/products(page=${i}, category=${categoryId}, search=${search})}"
                   th:text="${i}"></a>
                <span th:if="${i == currentPage}" th:text="${i}"></span>
            </span>

            <a th:if="${currentPage < totalPages}"
               th:href="@{/products(page=${currentPage + 1}, category=${categoryId}, search=${search})}">
                Sau »
            </a>
        </div>
    </div>

    <!-- Footer -->
    <div th:replace="~{client/fragments/footer :: footer}"></div>
</body>
</html>
